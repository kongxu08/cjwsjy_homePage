<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<title>新闻中心</title>
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">

		<!--标准mui.css-->
		<link rel="stylesheet" href="css/mui.min.css">
		<!--App自定义的css-->
		<!--<link rel="stylesheet" type="text/css" href="../css/app.css"/>-->
		<link rel="stylesheet" type="text/css" href="css/nav.css" />
		<style type="text/css">
			.mui-pull-bottom-tips {
				text-align: center;
				background-color: #efeff4;
				font-size: 15px;
				line-height: 40px;
				color: #777;
			}
			
			.mui-table-view-cell>a:not(.mui-btn) {
				position: relative;
				display: block;
				overflow: hidden;
				margin: -11px -15px;
				padding: inherit;
				white-space: normal;
				text-overflow: ellipsis;
				font-size: 15px;
				color: inherit;
			}
			
			.mui-slider-indicator {
				position: absolute;
				bottom: 38px;
				width: 100%;
				text-align: center;
				background: 0 0;
			}
			
			span {
				font-size: 14px;
				margin-bottom: 0px;
				color: #8f8f94
			}
		</style>
	</head>

	<body>
		<header id="header" class="mui-bar2 mui-bar-nav2">
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left" style="color: #FFFFFF;"></a>
			<a class="mui-icon mui-icon-search mui-pull-right" style="color: #FFFFFF;"></a>
			<h1 class="mui-title" id="head_title" style="color: #FFFFFF;">新闻中心</h1>
		</header>
		<div class="mui-content" style="position:fixed;">
			<div id="slider" class="mui-slider">
				<div class="mui-slider-group mui-slider-loop">
				</div>
				<div class="mui-slider-indicator mui-text-right">
					<div class="mui-indicator mui-active"></div>
					<div class="mui-indicator"></div>
					<div class="mui-indicator"></div>
					<div class="mui-indicator"></div>
					<div class="mui-indicator"></div>
				</div>
			</div>
		</div>
		<div id="sliderSegmentedControl" class="mui-slider-indicator mui-segmented-control mui-segmented-control-inverted" style="top:320px;background-color: #efeff4;z-index: 999;">
				<a class="mui-control-item mui-active" href="#tzgg">
					通知公告
				</a>
				<a class="mui-control-item" href="#tbgz">
					特别关注
				</a>
				<a class="mui-control-item" href="#qyxw">
					企业新闻
				</a>
		</div>
		<div class="mui-slider-group">
			<div id="tzgg" class="mui-slider-item mui-control-content mui-active">
				<div class="mui-scroll" style="top: 315px">
					<ul class="mui-table-view" data-page="1" data-source="GetIPSList_GGB2">
					</ul>
				</div>
			</div>
			<div id="tbgz" class="mui-slider-item mui-control-content">
				<div class="mui-scroll" style="top: 315px">
					<ul class="mui-table-view" data-page="1" data-source="GetIPSList_TBGZ2">

					</ul>
				</div>
			</div>
			<div id="qyxw" class="mui-slider-item mui-control-content">
				<div class="mui-scroll" style="top: 315px">
					<ul class="mui-table-view" data-page="1" data-source="GetIPSList_QYXW2">
					</ul>
				</div>
			</div>
		</div>
	</body>
	<script src="js/jquery-2.2.2.min.js"></script>
	<script src="js/mui.min.js"></script>
	<script src="js/app.js"></script>
	<script src="js/mui.pullToRefresh.js"></script>

	<script>
		$(function() {
			try{
				//记日志
				saveLogFunction("新闻中心")
			}catch(err){
			     console.log(err) // 可执行
			}
			
			//打开新闻搜索
			$('header a.mui-icon-search').on('tap', function() {
				window.location.href = 'newsSearch.html';
			})
			//打开新闻中心
			$('header a.mui-action-back').on('tap', function() {
				window.location.href = 'index2.html';
			})
			
			$.getJSON(appUrl+'/CEGWAPServer/XW/GetIPSList_GGB2/1', function(data) {
				$(data).each(function(index, item) {
					var _li = $("<li class='mui-table-view-cell'></li>")
					var _a = $("<a class='mui-navigate-right' href='javascript:void()'>")
					var _div = $('<div style>')
					var span = $("<span>")
					var span2 = $("<span style='float:right;margin-right:20px;'>")
					_a.html(item.Title)
					_a.attr("data-value", item.InfoGuid)
					_div.append(span)
					_div.append(span2)
					_a.append(_div)
					span.text(item.GroupName)
					span2.text(item.ShowTime)
					_li.append(_a)
					$('#tzgg ul').append(_li)
				})
			})
			$.getJSON(appUrl+'/CEGWAPServer/XW/GetIPSList_TBGZ2/1', function(data) {
				$(data).each(function(index, item) {
					var _li = $("<li class='mui-table-view-cell'></li>")
					var _a = $("<a class='mui-navigate-right' href='javascript:void()'>")
					var _div = $('<div style>')
					var span = $("<span>")
					var span2 = $("<span style='float:right;margin-right:20px;'>")
					_a.html(item.Title)
					_a.attr("data-value", item.InfoGuid)
					_div.append(span)
					_div.append(span2)
					_a.append(_div)
					span.text(item.GroupName)
					span2.text(item.ShowTime)
					_li.append(_a)
					$('#tbgz ul').append(_li)
				})
			})
			$.getJSON(appUrl+'/CEGWAPServer/XW/GetIPSList_QYXW2/1', function(data) {
				$(data).each(function(index, item) {
					var _li = $("<li class='mui-table-view-cell'></li>")
					var _a = $("<a class='mui-navigate-right' href='javascript:void()'>")
					var _div = $('<div style>')
					var span = $("<span>")
					var span2 = $("<span style='float:right;margin-right:20px;'>")
					_a.html(item.Title)
					_a.attr("data-value", item.InfoGuid)
					_div.append(span)
					_div.append(span2)
					_a.append(_div)
					span.text(item.GroupName)
					span2.text(item.ShowTime)
					_li.append(_a)
					$('#qyxw ul').append(_li)
				})
			})
			$.getJSON(appUrl+'/CEGWAPServer/XW/GetIPSList_Banner', function(data) {
				var first, last;
				$(data).each(function(index, item) {

					var _div = $("<div class='mui-slider-item'>")
					var _a = $("<a href='javascript:void()'>")
					var _img = $("<img width = '100%' height='276px'>")
					var _p = $("<p class='mui-slider-title'>")

					_a.attr('data-value', item.infoguid)
					_img.attr('src', item.pic)
					_p.text(item.title)

					_div.append(_a)
					_a.append(_img)
					_a.append(_p)

					$('#slider div.mui-slider-group').append(_div)
					if(index == 0)
						first = _div.clone();
					if(index == data.length - 1)
						last = _div.clone();
				})

				<!-- 额外增加的一个节点(循环轮播：最后一个节点是第一张轮播) -->
				$('#slider div.mui-slider-group').append(first)
				<!-- 额外增加的一个节点(循环轮播：第一个节点是最后一张轮播) -->
				$('#slider div.mui-slider-group').prepend(last)
				
			$("img").error(function() { 
				$(this).attr("src", "images/new-banner.jpg"); 
			}); 


				mui.init({
					swipeBack: true //启用右滑关闭功能
				});
				var slider = mui("#slider");
				slider.slider({
					interval: 5000
				});
				(function(m) {
					m.ready(function() {
						//循环初始化所有下拉刷新，上拉加载。
						m.each(document.querySelectorAll('.mui-slider-group .mui-scroll'), function(index, pullRefreshEl) {
							m(pullRefreshEl).pullToRefresh({
								up: {
									callback: function() {
										var self = this;
										setTimeout(function() {
											var ul = self.element.querySelector('.mui-table-view');
											createFragment(ul);
											self.pullUpTipsIcon.innerHTML = self.options.up.contentdown;
											self.loading = false;
										}, 1000);
									}
								}
							});
						});
						var createFragment = function(ul) {
							var length = ul.querySelectorAll('li').length;
							var fragment = document.createDocumentFragment();
							var li = [];
							var page = parseInt($(ul).attr('data-page'));
							page = page + 1;
							var source = $(ul).attr('data-source');
							$.getJSON(appUrl+'/CEGWAPServer/XW/' + source + '/' + page, function(data) {
								$(data).each(function(index, item) {
									var _li = $("<li class='mui-table-view-cell'></li>")
									var _a = $("<a class='mui-navigate-right' href='javascript:void()'>")
									var _div = $('<div style>')
									var span = $("<span>")
									var span2 = $("<span style='float:right;margin-right:20px;'>")
									_a.html(item.Title)
									_a.attr("data-value", item.InfoGuid)
									_div.append(span)
									_div.append(span2)
									_a.append(_div)
									span.text(item.GroupName)
									span2.text(item.ShowTime)
									_li.append(_a)
									$(ul).append(_li)
								})
							})
							$(ul).attr('data-page', page)
						};
					});
				})(mui);
			})
			
			var u = localStorage.getItem('loginName');
			//动态绑定事件
			$('body').delegate('a.mui-navigate-right','click',function(){
				var url = appUrl+'/CEGWAPServer/XW/GetIPSForm/'+u+'/'+$(this).attr('data-value')
				openWebViewFunction(url)
				return false;
			})
			$('#slider').delegate('a','click',function(){
				var url = appUrl+'/CEGWAPServer/XW/GetIPSForm/'+u+'/'+$(this).attr('data-value')
				openWebViewFunction(url)
				return false;
			})
		})
 $(window).scroll(function(event){
    var wScrollY = window.scrollY; // 当前滚动条位置  
    var wInnerH = window.innerHeight; // 设备窗口的高度（不会变）  
    var bScrollH = document.body.scrollHeight; // 滚动条总高度      
    if(wScrollY>=276){
    	$("#sliderSegmentedControl").css("position","fixed")
    	$("#sliderSegmentedControl").css("top","44px")
    }else{
    	$("#sliderSegmentedControl").css("position","")
    	$("#sliderSegmentedControl").css("top","320px")
    }
});
	</script>

</html>